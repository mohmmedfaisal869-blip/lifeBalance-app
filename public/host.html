<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>LifeBalance ‚Äî Host Page</title>
    <style>
      body { font-family: Inter, Arial, sans-serif; background:#f8fafc; color:#0f172a; padding:24px }
      table { width:100%; border-collapse:collapse; margin-top:12px }
      th,td { padding:12px; border:1px solid #e2e8f0; text-align:left; vertical-align:top }
      th { background:#0ea5e9; color:white }
      .small { font-size:12px; color:#475569 }
      .mono { font-family: monospace; font-size:12px }
      pre { white-space:pre-wrap; word-break:break-word }
      .card { background:white; border-radius:16px; padding:20px; margin:12px 0; box-shadow:0 4px 6px rgba(0,0,0,0.1); border:1px solid #e2e8f0 }
      .card h3 { margin:0 0 12px 0; color:#0ea5e9 }
      .stat-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap:12px }
      .stat-box { background:#f1f5f9; padding:16px; border-radius:12px; text-align:center }
      .stat-box .value { font-size:28px; font-weight:800; color:#0f172a }
      .stat-box .label { font-size:11px; color:#64748b; text-transform:uppercase; letter-spacing:1px }
      .quran-card { background: linear-gradient(135deg, #d97706 0%, #b45309 100%); color:white }
      .quran-card h3 { color:white }
      .quran-card .stat-box { background:rgba(255,255,255,0.2) }
      .quran-card .stat-box .value { color:white }
      .quran-card .stat-box .label { color:rgba(255,255,255,0.8) }
      .tab-buttons { display:flex; gap:8px; margin-bottom:16px; flex-wrap:wrap }
      .tab-btn { padding:10px 20px; border:none; border-radius:8px; cursor:pointer; font-weight:600 }
      .tab-btn.active { background:#0ea5e9; color:white }
      .tab-btn:not(.active) { background:#e2e8f0 }
      .tab-content { display:none }
      .tab-content.active { display:block }
      .loading { text-align:center; padding:40px; color:#64748b }
      .db-badge { background:#10b981; color:white; padding:4px 12px; border-radius:20px; font-size:12px; margin-left:8px }
      .user-row { cursor:pointer; transition: background 0.2s }
      .user-row:hover { background:#f0f9ff !important }
      
      /* Modal styles */
      .modal-overlay { position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); display:none; justify-content:center; align-items:center; z-index:1000; padding:20px; overflow-y:auto }
      .modal-overlay.active { display:flex }
      .modal { background:white; border-radius:20px; max-width:800px; width:100%; max-height:90vh; overflow-y:auto; box-shadow:0 25px 50px rgba(0,0,0,0.25) }
      .modal-header { background:linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%); color:white; padding:24px; border-radius:20px 20px 0 0; position:sticky; top:0 }
      .modal-header h2 { margin:0 0 8px 0; font-size:24px }
      .modal-header .email { opacity:0.9; font-size:14px }
      .modal-close { position:absolute; top:20px; right:20px; background:rgba(255,255,255,0.2); border:none; color:white; width:36px; height:36px; border-radius:50%; cursor:pointer; font-size:20px }
      .modal-close:hover { background:rgba(255,255,255,0.3) }
      .modal-body { padding:24px }
      .section { margin-bottom:24px }
      .section h4 { margin:0 0 12px 0; color:#0ea5e9; font-size:16px; display:flex; align-items:center; gap:8px }
      .section-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap:12px }
      .section-stat { background:#f8fafc; padding:12px; border-radius:10px; border:1px solid #e2e8f0 }
      .section-stat .val { font-size:20px; font-weight:700; color:#0f172a }
      .section-stat .lbl { font-size:11px; color:#64748b; text-transform:uppercase }
      .task-item { background:#f8fafc; padding:12px; border-radius:8px; margin:8px 0; border-left:4px solid #0ea5e9 }
      .task-item.done { border-left-color:#10b981; opacity:0.7 }
      .gratitude-item { background:#fef3c7; padding:12px; border-radius:8px; margin:8px 0; border-left:4px solid #f59e0b }
      .badge { display:inline-block; padding:4px 10px; border-radius:20px; font-size:11px; font-weight:600 }
      .badge-green { background:#d1fae5; color:#059669 }
      .badge-blue { background:#dbeafe; color:#2563eb }
      .badge-orange { background:#fed7aa; color:#c2410c }
      .badge-gray { background:#e2e8f0; color:#475569 }
    </style>
  </head>
  <body>
    <h1>üè† Host Page ‚Äî LifeBalance Admin <span class="db-badge">‚òÅÔ∏è Cloud Database</span></h1>
    <p class="small">Click on any user to see their full details! Data synced from Supabase cloud.</p>
    
    <div id="auth" style="max-width:480px;margin-top:16px"></div>
    <div id="content"><div class="loading">‚è≥ Loading from database...</div></div>
    
    <!-- User Detail Modal -->
    <div id="userModal" class="modal-overlay" onclick="if(event.target===this)closeModal()">
      <div class="modal">
        <div class="modal-header">
          <button class="modal-close" onclick="closeModal()">‚úï</button>
          <h2 id="modalUserName">User Name</h2>
          <div class="email" id="modalUserEmail">user@email.com</div>
        </div>
        <div class="modal-body" id="modalBody">
          <!-- Content will be inserted here -->
        </div>
      </div>
    </div>

    <script>
      // Supabase configuration
      const SUPABASE_URL = 'https://hagdmdogxwuueooczqji.supabase.co';
      const SUPABASE_KEY = 'sb_publishable_aS384Eu8SSr5ij21ykCkMA_nMtbOR8A';
      
      // Store users globally for modal access
      let allUsers = [];

      // Fetch users from Supabase
      async function fetchUsersFromSupabase() {
        try {
          const response = await fetch(`${SUPABASE_URL}/rest/v1/users?select=*&order=updated_at.desc`, {
            headers: {
              'apikey': SUPABASE_KEY,
              'Authorization': `Bearer ${SUPABASE_KEY}`,
            }
          });
          if (!response.ok) throw new Error('Failed to fetch');
          return await response.json();
        } catch (error) {
          console.error('Supabase fetch error:', error);
          return [];
        }
      }

      if (!localStorage.getItem('host_password')) {
        localStorage.setItem('host_password', 'Fsa12joh1moh2FMJZ');
      }

      function readSuggestions() {
        try {
          const raw = localStorage.getItem('lifebalance_suggestions');
          return raw ? JSON.parse(raw) : [];
        } catch (e) { return []; }
      }

      function isLoggedIn(){
        return sessionStorage.getItem('host_logged_in') === '1';
      }

      function setLoggedIn(name){
        sessionStorage.setItem('host_logged_in','1');
        sessionStorage.setItem('host_admin_name', name||'admin');
      }

      function logout(){
        sessionStorage.removeItem('host_logged_in');
        sessionStorage.removeItem('host_admin_name');
        location.reload();
      }
      
      function closeModal() {
        document.getElementById('userModal').classList.remove('active');
      }
      
      function showUserDetail(userId) {
        const user = allUsers.find(u => u.id === userId);
        if (!user) return;
        
        document.getElementById('modalUserName').textContent = user.name || 'Unknown User';
        document.getElementById('modalUserEmail').textContent = user.email || user.id;
        
        const prefs = user.full_prefs || {};
        const sleepData = user.sleep_data || {};
        const tasksData = user.tasks_data || [];
        const gratitudeData = user.gratitude_data || [];
        
        let html = `
          <!-- Basic Info -->
          <div class="section">
            <h4>üë§ Basic Information</h4>
            <div class="section-grid">
              <div class="section-stat">
                <div class="val">${user.name || '‚Äî'}</div>
                <div class="lbl">Name</div>
              </div>
              <div class="section-stat">
                <div class="val">${user.is_guest ? 'Yes' : 'No'}</div>
                <div class="lbl">Guest Account</div>
              </div>
              <div class="section-stat">
                <div class="val">${user.created_at ? new Date(user.created_at).toLocaleDateString() : '‚Äî'}</div>
                <div class="lbl">Joined</div>
              </div>
              <div class="section-stat">
                <div class="val">${user.updated_at ? new Date(user.updated_at).toLocaleString() : '‚Äî'}</div>
                <div class="lbl">Last Active</div>
              </div>
            </div>
          </div>
          
          <!-- Settings -->
          <div class="section">
            <h4>‚öôÔ∏è User Settings</h4>
            <div class="section-grid">
              <div class="section-stat">
                <div class="val">${prefs.language === 'ar' ? 'üá∏üá¶ Arabic' : 'üá∫üá∏ English'}</div>
                <div class="lbl">Language</div>
              </div>
              <div class="section-stat">
                <div class="val">${prefs.theme === 'dark' ? 'üåô Dark' : '‚òÄÔ∏è Light'}</div>
                <div class="lbl">Theme</div>
              </div>
              <div class="section-stat">
                <div class="val">${prefs.streak || 0} days</div>
                <div class="lbl">App Streak</div>
              </div>
            </div>
          </div>
          
          <!-- Water Stats -->
          <div class="section">
            <h4>üíß Water Tracker</h4>
            <div class="section-grid">
              <div class="section-stat">
                <div class="val" style="color:#0ea5e9">${user.water_intake || 0} ml</div>
                <div class="lbl">Today's Intake</div>
              </div>
              <div class="section-stat">
                <div class="val">${user.water_goal || 2000} ml</div>
                <div class="lbl">Daily Goal</div>
              </div>
              <div class="section-stat">
                <div class="val">${Math.round(((user.water_intake || 0) / (user.water_goal || 2000)) * 100)}%</div>
                <div class="lbl">Progress</div>
              </div>
            </div>
          </div>
          
          <!-- Quran Stats -->
          <div class="section">
            <h4>üìñ Quran Reading</h4>
            <div class="section-grid">
              <div class="section-stat">
                <div class="val" style="color:#d97706">${user.quran_pages_today || 0}</div>
                <div class="lbl">Pages Today</div>
              </div>
              <div class="section-stat">
                <div class="val">${user.quran_daily_goal || 5}</div>
                <div class="lbl">Daily Goal</div>
              </div>
              <div class="section-stat">
                <div class="val" style="color:#d97706">${user.quran_total_pages || 0}</div>
                <div class="lbl">Total Pages</div>
              </div>
              <div class="section-stat">
                <div class="val" style="color:#10b981">${user.quran_streak || 0} days</div>
                <div class="lbl">Reading Streak</div>
              </div>
              <div class="section-stat">
                <div class="val">${prefs.quranEdition || 'kingFahd'}</div>
                <div class="lbl">Quran Edition</div>
              </div>
            </div>
          </div>
          
          <!-- Sleep Stats -->
          <div class="section">
            <h4>üò¥ Sleep Settings</h4>
            <div class="section-grid">
              <div class="section-stat">
                <div class="val">${sleepData.wakeupTime || prefs.wakeupTime || '07:00'}</div>
                <div class="lbl">Weekday Wake</div>
              </div>
              <div class="section-stat">
                <div class="val">${sleepData.weekendWakeupTime || prefs.weekendWakeupTime || '09:00'}</div>
                <div class="lbl">Weekend Wake</div>
              </div>
              <div class="section-stat">
                <div class="val">${sleepData.isAlarmEnabled ? '‚úÖ On' : '‚ùå Off'}</div>
                <div class="lbl">Alarm</div>
              </div>
            </div>
          </div>
          
          <!-- Tasks -->
          <div class="section">
            <h4>‚úÖ Tasks (${tasksData.length} recent)</h4>
            <div class="section-grid" style="margin-bottom:12px">
              <div class="section-stat">
                <div class="val" style="color:#10b981">${user.tasks_completed || 0}</div>
                <div class="lbl">Completed</div>
              </div>
              <div class="section-stat">
                <div class="val">${tasksData.filter(t => t.status !== 'done').length}</div>
                <div class="lbl">Pending</div>
              </div>
            </div>`;
        
        if (tasksData.length > 0) {
          html += `<div style="max-height:200px;overflow-y:auto">`;
          tasksData.slice(0, 10).forEach(task => {
            const isDone = task.status === 'done';
            const priorityColors = { high: '#ef4444', medium: '#f59e0b', low: '#10b981' };
            html += `<div class="task-item ${isDone ? 'done' : ''}">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <strong>${isDone ? '‚úÖ' : '‚è≥'} ${task.title || 'Untitled Task'}</strong>
                <span class="badge" style="background:${priorityColors[task.priority] || '#e2e8f0'}20;color:${priorityColors[task.priority] || '#475569'}">${task.priority || 'medium'}</span>
              </div>
              ${task.description ? `<div class="small" style="margin-top:4px">${task.description}</div>` : ''}
            </div>`;
          });
          html += `</div>`;
        } else {
          html += `<p class="small">No tasks recorded yet.</p>`;
        }
        
        html += `</div>
          
          <!-- Gratitude -->
          <div class="section">
            <h4>üíõ Gratitude Notes (${gratitudeData.length} total)</h4>`;
        
        if (gratitudeData.length > 0) {
          html += `<div style="max-height:200px;overflow-y:auto">`;
          gratitudeData.slice(0, 10).forEach(note => {
            const noteText = typeof note === 'string' ? note : (note.text || note.note || JSON.stringify(note));
            const noteDate = note.date ? new Date(note.date).toLocaleDateString() : '';
            html += `<div class="gratitude-item">
              <div>${noteText}</div>
              ${noteDate ? `<div class="small" style="margin-top:4px">${noteDate}</div>` : ''}
            </div>`;
          });
          html += `</div>`;
        } else {
          html += `<p class="small">No gratitude notes yet.</p>`;
        }
        
        html += `</div>`;
        
        document.getElementById('modalBody').innerHTML = html;
        document.getElementById('userModal').classList.add('active');
      }

      function showAuth() {
        const auth = document.getElementById('auth');
        const stored = localStorage.getItem('host_password');
        if (!stored) {
          auth.innerHTML = `<div class="card"><h3>üîê Set Host Password</h3>
            <p class="small">No host password set. Create one to protect this page.</p>
            <div style="margin-top:8px"><input id="hpw" placeholder="New password" type="password" style="width:100%;padding:10px;border-radius:8px;border:1px solid #cbd5e1" /></div>
            <div style="margin-top:8px"><button id="hpwBtn" style="padding:10px 16px;background:#0ea5e9;color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:600">Set Password</button></div></div>`;
          document.getElementById('hpwBtn').onclick = function(){
            const v = document.getElementById('hpw').value;
            if(!v) return alert('Please enter a password');
            localStorage.setItem('host_password', v);
            alert('Password saved. Please login.');
            showAuth();
          };
        } else {
          auth.innerHTML = `<div class="card"><h3>üîê Host Login</h3>
            <div style="margin-top:8px"><label>Name</label><input id="hn" placeholder="admin name" style="width:100%;padding:10px;border-radius:8px;border:1px solid #cbd5e1;margin-top:4px" /></div>
            <div style="margin-top:12px"><label>Password</label><input id="hpwLogin" placeholder="password" type="password" style="width:100%;padding:10px;border-radius:8px;border:1px solid #cbd5e1;margin-top:4px" /></div>
            <div style="margin-top:12px;display:flex;gap:8px"><button id="loginBtn" style="padding:10px 16px;background:#0ea5e9;color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:600">Login</button><button id="clearBtn" style="padding:10px 16px;background:#e2e8f0;border:none;border-radius:8px;cursor:pointer">Clear</button></div></div>`;
          document.getElementById('loginBtn').onclick = function(){
            const name = document.getElementById('hn').value || 'admin';
            const pw = document.getElementById('hpwLogin').value;
            if(pw === localStorage.getItem('host_password')){ setLoggedIn(name); render(); document.getElementById('auth').style.display='none'; }
            else alert('Incorrect password');
          };
          document.getElementById('clearBtn').onclick = function(){ document.getElementById('hn').value=''; document.getElementById('hpwLogin').value=''; };
        }
      }

      async function render() {
        if(!isLoggedIn()){ showAuth(); document.getElementById('content').innerHTML = '<p class="small" style="margin-top:20px">Please login to view host data.</p>'; return; }
        
        const adminName = sessionStorage.getItem('host_admin_name')||'admin';
        document.getElementById('auth').innerHTML = `<div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;flex-wrap:wrap">
          <span style="background:#10b981;color:white;padding:8px 16px;border-radius:20px;font-weight:600">‚úì Logged in as ${adminName}</span>
          <button id="logoutBtn" style="padding:8px 16px;border-radius:8px;border:1px solid #e2e8f0;cursor:pointer">Logout</button>
          <button id="refreshBtn" style="padding:8px 16px;border-radius:8px;background:#0ea5e9;color:white;border:none;cursor:pointer">üîÑ Refresh</button>
        </div>`;
        document.getElementById('logoutBtn').onclick = logout;
        document.getElementById('refreshBtn').onclick = render;

        document.getElementById('content').innerHTML = '<div class="loading">‚è≥ Loading from Supabase...</div>';
        
        // Fetch from Supabase
        allUsers = await fetchUsersFromSupabase();
        const suggestions = readSuggestions();

        // Calculate totals
        let totalQuranPages = 0;
        let totalWaterIntake = 0;
        let totalTasks = 0;
        let totalGratitude = 0;
        
        allUsers.forEach(u => {
          totalQuranPages += u.quran_total_pages || 0;
          totalWaterIntake += u.water_intake || 0;
          totalTasks += u.tasks_completed || 0;
          totalGratitude += u.gratitude_count || 0;
        });

        let html = `
          <div class="tab-buttons">
            <button class="tab-btn active" onclick="showTab('overview')">üìä Overview</button>
            <button class="tab-btn" onclick="showTab('quran')">üìñ Quran</button>
            <button class="tab-btn" onclick="showTab('water')">üíß Water</button>
            <button class="tab-btn" onclick="showTab('users')">üë• Users</button>
            <button class="tab-btn" onclick="showTab('suggestions')">üí¨ Suggestions</button>
          </div>

          <!-- Overview Tab -->
          <div id="tab-overview" class="tab-content active">
            <div class="card">
              <h3>üìä Overall Statistics</h3>
              <div class="stat-grid">
                <div class="stat-box">
                  <div class="value">${allUsers.length}</div>
                  <div class="label">Total Users</div>
                </div>
                <div class="stat-box">
                  <div class="value">${totalQuranPages}</div>
                  <div class="label">Quran Pages</div>
                </div>
                <div class="stat-box">
                  <div class="value">${(totalWaterIntake / 1000).toFixed(1)}L</div>
                  <div class="label">Water Consumed</div>
                </div>
                <div class="stat-box">
                  <div class="value">${totalTasks}</div>
                  <div class="label">Tasks Done</div>
                </div>
                <div class="stat-box">
                  <div class="value">${totalGratitude}</div>
                  <div class="label">Gratitude Notes</div>
                </div>
                <div class="stat-box">
                  <div class="value">${suggestions.length}</div>
                  <div class="label">Suggestions</div>
                </div>
              </div>
            </div>
            
            <div class="card">
              <h3>üë• Quick User List <span class="small">(click to see details)</span></h3>
              <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px">`;
        
        allUsers.forEach(u => {
          html += `<div onclick="showUserDetail('${u.id}')" style="background:#f8fafc;padding:16px;border-radius:12px;cursor:pointer;border:1px solid #e2e8f0;transition:all 0.2s" onmouseover="this.style.borderColor='#0ea5e9';this.style.transform='translateY(-2px)'" onmouseout="this.style.borderColor='#e2e8f0';this.style.transform='none'">
            <div style="font-weight:600;color:#0f172a">${u.name || 'Unknown'}</div>
            <div class="small">${u.email || u.id}</div>
            <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
              <span class="badge badge-blue">üìñ ${u.quran_total_pages || 0}</span>
              <span class="badge badge-green">‚úÖ ${u.tasks_completed || 0}</span>
            </div>
          </div>`;
        });
        
        html += `</div></div></div>

          <!-- Quran Tab -->
          <div id="tab-quran" class="tab-content">
            <div class="card quran-card">
              <h3>üìñ Quran Reading Statistics</h3>
              <div class="stat-grid">
                <div class="stat-box">
                  <div class="value">${totalQuranPages}</div>
                  <div class="label">Total Pages (All Users)</div>
                </div>
                <div class="stat-box">
                  <div class="value">${allUsers.reduce((sum, u) => sum + (u.quran_pages_today || 0), 0)}</div>
                  <div class="label">Pages Read Today</div>
                </div>
              </div>
            </div>
            <div class="card">
              <h3>üìñ Per-User Quran Stats <span class="small">(click row for details)</span></h3>
              <table>
                <thead><tr><th>User</th><th>Today</th><th>Goal</th><th>Total</th><th>Streak</th><th>Progress</th></tr></thead>
                <tbody>`;
        
        allUsers.forEach(u => {
          const pagesRead = u.quran_pages_today || 0;
          const pagesGoal = u.quran_daily_goal || 5;
          const totalPages = u.quran_total_pages || 0;
          const streakDays = u.quran_streak || 0;
          const progress = Math.min(100, (pagesRead / Math.max(1, pagesGoal)) * 100).toFixed(0);
          html += `<tr class="user-row" onclick="showUserDetail('${u.id}')">
            <td><strong>${u.name || u.email || u.id}</strong></td>
            <td><strong>${pagesRead}</strong></td>
            <td>${pagesGoal}</td>
            <td style="color:#d97706;font-weight:bold">${totalPages}</td>
            <td style="color:#10b981;font-weight:bold">${streakDays}d</td>
            <td>
              <div style="background:#e2e8f0;border-radius:4px;height:20px;width:80px;overflow:hidden;display:inline-block;vertical-align:middle">
                <div style="background:#d97706;height:100%;width:${progress}%"></div>
              </div>
              ${progress}%
            </td>
          </tr>`;
        });
        
        html += `</tbody></table></div></div>

          <!-- Water Tab -->
          <div id="tab-water" class="tab-content">
            <div class="card" style="background:linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);color:white">
              <h3 style="color:white">üíß Water Tracking Statistics</h3>
              <div class="stat-grid">
                <div class="stat-box" style="background:rgba(255,255,255,0.2)">
                  <div class="value" style="color:white">${(totalWaterIntake / 1000).toFixed(1)}L</div>
                  <div class="label" style="color:rgba(255,255,255,0.8)">Total Consumed</div>
                </div>
                <div class="stat-box" style="background:rgba(255,255,255,0.2)">
                  <div class="value" style="color:white">${allUsers.length > 0 ? Math.round(totalWaterIntake / allUsers.length) : 0} ml</div>
                  <div class="label" style="color:rgba(255,255,255,0.8)">Avg Per User</div>
                </div>
              </div>
            </div>
            <div class="card">
              <h3>üíß Per-User Water Stats <span class="small">(click row for details)</span></h3>
              <table>
                <thead><tr><th>User</th><th>Today</th><th>Goal</th><th>Progress</th></tr></thead>
                <tbody>`;
        
        allUsers.forEach(u => {
          const intake = u.water_intake || 0;
          const goal = u.water_goal || 2000;
          const progress = Math.min(100, (intake / goal) * 100).toFixed(0);
          html += `<tr class="user-row" onclick="showUserDetail('${u.id}')">
            <td><strong>${u.name || u.email || u.id}</strong></td>
            <td style="color:#0ea5e9;font-weight:bold">${intake} ml</td>
            <td>${goal} ml</td>
            <td>
              <div style="background:#e2e8f0;border-radius:4px;height:20px;width:80px;overflow:hidden;display:inline-block;vertical-align:middle">
                <div style="background:#0ea5e9;height:100%;width:${progress}%"></div>
              </div>
              ${progress}%
            </td>
          </tr>`;
        });
        
        html += `</tbody></table></div></div>

          <!-- Users Tab -->
          <div id="tab-users" class="tab-content">
            <div class="card">
              <h3>üë• All Users (${allUsers.length}) <span class="small">‚Äî click any row for full details</span></h3>
              <table>
                <thead><tr><th>Email</th><th>Name</th><th>Type</th><th>Quran</th><th>Water</th><th>Tasks</th><th>Last Active</th></tr></thead>
                <tbody>`;
        
        allUsers.forEach(u => {
          html += `<tr class="user-row" onclick="showUserDetail('${u.id}')">
            <td class="mono">${u.email || u.id}</td>
            <td>${u.name || '‚Äî'}</td>
            <td>${u.is_guest ? '<span class="badge badge-gray">Guest</span>' : '<span class="badge badge-green">Member</span>'}</td>
            <td><span class="badge badge-orange">üìñ ${u.quran_total_pages || 0}</span></td>
            <td><span class="badge badge-blue">üíß ${u.water_intake || 0}ml</span></td>
            <td><span class="badge badge-green">‚úÖ ${u.tasks_completed || 0}</span></td>
            <td class="small">${u.updated_at ? new Date(u.updated_at).toLocaleString() : '‚Äî'}</td>
          </tr>`;
        });
        
        html += `</tbody></table></div></div>

          <!-- Suggestions Tab -->
          <div id="tab-suggestions" class="tab-content">
            <div class="card">
              <h3>üí¨ User Suggestions (${suggestions.length})</h3>`;
        
        if (suggestions.length) {
          html += `<table><thead><tr><th>Time</th><th>User</th><th>Message</th></tr></thead><tbody>`;
          suggestions.forEach(s => {
            const when = s.ts ? new Date(s.ts).toLocaleString() : '‚Äî';
            const user = s.user ? (s.user.name || s.user.email || 'Unknown') : 'Anonymous';
            html += `<tr><td class="mono">${when}</td><td>${user}</td><td><pre>${s.text || ''}</pre></td></tr>`;
          });
          html += `</tbody></table>`;
        } else {
          html += `<p class="small">No suggestions yet.</p>`;
        }
        
        html += `</div></div>`;

        document.getElementById('content').innerHTML = html;
      }

      function showTab(name) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById('tab-' + name).classList.add('active');
        event.target.classList.add('active');
      }

      render();
    </script>
  </body>
</html>
